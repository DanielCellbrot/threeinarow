<!doctype html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="stylesheet.css">

	<link rel="shortcut icon" type="image/png" href="images/favicon.png" />
</head>
<!DOCTYPE html>

<head>
	<link rel="stylesheet" href="stylesheet.css">
</head>

<body>
	<table id="table0">
		<tr>
			<td class="cell" id="0"></td>
			<td class="cell" id="1"></td>
			<td class="cell" id="2"></td>
		</tr>
		<tr>
			<td class="cell" id="3"></td>
			<td class="cell" id="4"></td>
			<td class="cell" id="5"></td>
		</tr>
		<tr>
			<td class="cell" id="6"></td>
			<td class="cell" id="7"></td>
			<td class="cell" id="8"></td>
		</tr>
	</table>
	<table id="table1">
		<tr>
			<td class="cell" id="9"></td>
			<td class="cell" id="10"></td>
			<td class="cell" id="11"></td>
		</tr>
		<tr>
			<td class="cell" id="12"></td>
			<td class="cell" id="13"></td>
			<td class="cell" id="14"></td>
		</tr>
		<tr>
			<td class="cell" id="15"></td>
			<td class="cell" id="16"></td>
			<td class="cell" id="17"></td>
		</tr>
	</table>
	<table id="table2">
		<tr>
			<td class="cell" id="18"></td>
			<td class="cell" id="19"></td>
			<td class="cell" id="20"></td>
		</tr>
		<tr>
			<td class="cell" id="21"></td>
			<td class="cell" id="22"></td>
			<td class="cell" id="23"></td>
		</tr>
		<tr>
			<td class="cell" id="24"></td>
			<td class="cell" id="25"></td>
			<td class="cell" id="26"></td>
		</tr>
	</table>
	<table id="table3">
		<tr>
			<td class="cell" id="27"></td>
			<td class="cell" id="28"></td>
			<td class="cell" id="29"></td>
		</tr>
		<tr>
			<td class="cell" id="30"></td>
			<td class="cell" id="31"></td>
			<td class="cell" id="32"></td>
		</tr>
		<tr>
			<td class="cell" id="33"></td>
			<td class="cell" id="34"></td>
			<td class="cell" id="35"></td>
		</tr>
	</table>
	<table id="table4">
		<tr>
			<td class="cell" id="36"></td>
			<td class="cell" id="37"></td>
			<td class="cell" id="38"></td>
		</tr>
		<tr>
			<td class="cell" id="39"></td>
			<td class="cell" id="40"></td>
			<td class="cell" id="41"></td>
		</tr>
		<tr>
			<td class="cell" id="42"></td>
			<td class="cell" id="43"></td>
			<td class="cell" id="44"></td>
		</tr>
	</table>
	<table id="table5">
		<tr>
			<td class="cell" id="45"></td>
			<td class="cell" id="46"></td>
			<td class="cell" id="47"></td>
		</tr>
		<tr>
			<td class="cell" id="48"></td>
			<td class="cell" id="49"></td>
			<td class="cell" id="50"></td>
		</tr>
		<tr>
			<td class="cell" id="51"></td>
			<td class="cell" id="52"></td>
			<td class="cell" id="53"></td>
		</tr>
	</table>
	<table id="table6">
		<tr>
			<td class="cell" id="54"></td>
			<td class="cell" id="55"></td>
			<td class="cell" id="56"></td>
		</tr>
		<tr>
			<td class="cell" id="57"></td>
			<td class="cell" id="58"></td>
			<td class="cell" id="59"></td>
		</tr>
		<tr>
			<td class="cell" id="60"></td>
			<td class="cell" id="61"></td>
			<td class="cell" id="62"></td>
		</tr>
	</table>
	<table id="table7">
		<tr>
			<td class="cell" id="63"></td>
			<td class="cell" id="64"></td>
			<td class="cell" id="65"></td>
		</tr>
		<tr>
			<td class="cell" id="66"></td>
			<td class="cell" id="67"></td>
			<td class="cell" id="68"></td>
		</tr>
		<tr>
			<td class="cell" id="69"></td>
			<td class="cell" id="70"></td>
			<td class="cell" id="71"></td>
		</tr>
	</table>
	<table id="table8">
		<tr>
			<td class="cell" id="72"></td>
			<td class="cell" id="73"></td>
			<td class="cell" id="74"></td>
		</tr>
		<tr>
			<td class="cell" id="75"></td>
			<td class="cell" id="76"></td>
			<td class="cell" id="77"></td>
		</tr>
		<tr>
			<td class="cell" id="78"></td>
			<td class="cell" id="79"></td>
			<td class="cell" id="80"></td>
		</tr>
	</table>
	
	<button type="button" class="resetgame" onclick="resetGame()">Reset</button>
	<button type="button" class="autogenerate"onclick="randomInit()">Auto Generate Input</button>
	<p id="currentplayah">Current player: X</p>
	
</body>
<script>
	const winCombos = [
		[0, 1, 2],
		[3, 4, 5],
		[6, 7, 8],
		[0, 3, 6],
		[1, 4, 7],
		[2, 5, 8],
		[0, 4, 8],
		[6, 4, 2]
	]
	var bigboard = [];
	var size = 3
	var cells;
	var currentPlayer = 1;
	var lastChoise;
	var lastCell;
	var savedSquare;
	var avaliableBoards = [];
	startGame();
	function startGame() {
		cells = document.querySelectorAll('.cell');
		for (j = 0; j < size * size; j++) {
			bigboard.push([]);
			avaliableBoards.push(0);
			for (i = 0; i < size * size; i++) {
				bigboard[j].push(0);
			}
		}
		for (var i = 0; i < cells.length; i++) {
			cells[i].innerText = '';
			cells[i].style.removeProperty('background-color');
			cells[i].addEventListener('click', turn, false);
		}
		for(i = 0; i < size * size; i++){
			document.getElementById("table" + i.toString()).style.backgroundColor = "Green";
		}
	}
	function resetGame(){
		bigboard = [];
		currentPlayer = 1;
		lastChoise = undefined;
		savedSquare = undefined;
		avaliableBoards = [];
		startGame();
	}

	function randomInit() {
		setTimeout(function () {
			document.getElementById((Math.floor(Math.random() * Math.floor(80))).toString()).click();
			randomInit();
		}, 10);
	}


	//Generate dynamically lattter
	function turn(square) {
		//9x9 array's index
		var miniBoard = Math.floor(square.target.id / 9);
		//Cell's index
		if(lastCell == undefined){
			lastCell = square.target.id % 9;
		}
		var cell = square.target.id % 9;
		if ((miniBoard == lastChoise || lastChoise == undefined) && avaliableBoards[miniBoard] == 0) {
			if (square.target.innerText == "") {
				document.getElementById("table" + lastCell.toString()).style.backgroundColor = "White";
				if(currentPlayer == 1){
					document.getElementById(square.target.id).innerText = "X";
				}
				else{
					document.getElementById(square.target.id).innerText = "O";
				}
				bigboard[miniBoard][cell] = currentPlayer;
				var wincheck = checkSmallWin(bigboard[miniBoard], miniBoard, square)
				if(wincheck == 0){
					if(avaliableBoards[cell] == 0){
						for(i = 0; i < size * size; i++){
							document.getElementById("table" + i.toString()).style.backgroundColor = "White";
						}
						document.getElementById("table" + cell.toString()).style.backgroundColor = "Green";
						lastChoise = cell;
					}
					else{
						for(i = 0; i < size * size; i++){
							if(avaliableBoards[i] == 0){
								document.getElementById("table" + i.toString()).style.backgroundColor = "Green";
							}
						}
						lastChoise = undefined;
					}
				}
				else if(wincheck == 2 || wincheck == 1){
					for(i = 0; i < size * size; i++){
						if(avaliableBoards[i] == 0){
							document.getElementById("table" + i.toString()).style.backgroundColor = "Green";
						}
					}
					lastChoise = undefined;
				}
				if (currentPlayer == 1) {
					currentPlayer = 2
					document.getElementById("currentplayah").innerText = "Current player: O"
					
				}
				else {
					currentPlayer = 1
					document.getElementById("currentplayah").innerText = "Current player: X"
				}
			}
		}
		lastCell = cell;
	}
	function checkBigWin(){
		for (i = 0; i < winCombos.length; i++) {
			var playerOne = 0;
			var playerTwo = 0;
			for (j = 0; j < size; j++) {
				if (avaliableBoards[winCombos[i][j]] == 1) {
					playerOne += 1;
				}
				else if (avaliableBoards[winCombos[i][j]] == 2) {
					playerTwo += 1;
				}
			}
			if (playerOne == size) {
				alert("BIG WIN FROM PLAYUYR JUAN")
			}
			else if (playerTwo == size) {
				alert("BIG WIN FROM PLAYUYR NOT JUAN")
			}
		}
	}
	function checkSmallWin(board, boardNr, square) {
		var fullCounter = 0;
		var fullbool = 0;
		for (i = 0; i < winCombos.length; i++) {
			var playerOne = 0;
			var playerTwo = 0;
			for (j = 0; j < size; j++) {
				if (board[winCombos[i][j]] == 1) {
					playerOne += 1;
				}
				else if (board[winCombos[i][j]] == 2) {
					playerTwo += 1;
				}
			}
			if (playerOne == size) {
				winner(boardNr, square)
				return 0;
			}
			else if (playerTwo == size) {
				winner(boardNr, square);
				return 0;
			}
		}
		for(i = 0; i < size*size; i++){
			if(board[i] == 1 || board[i] == 2){
				fullCounter++;
				if(fullCounter == size * size){
					avaliableBoards[boardNr] = 3;
					fullbool = 1;
				}
			}
		}
		if(fullbool){
			return 0;
		}
		else{
			return 0;
		}
	}

	function winner(boardNr, square) {
		avaliableBoards[boardNr] = currentPlayer;
		for (i = 0; i < size * size; i++) {
			var updateId = (boardNr * 9);
			bigboard[boardNr][i] = currentPlayer;
			if(currentPlayer == 1){
				document.getElementById(updateId + i).innerText = "X";
			}
			else{
				document.getElementById(updateId + i).innerText = "O";
			}
		}
		checkBigWin();
	}
</script>
</html>